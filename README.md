### é¡¹ç›®ç»“æ„
```
â”œâ”€src
â”‚  â”œâ”€main
â”‚  â”‚  â”œâ”€java
â”‚  â”‚  â”‚  â””â”€com
â”‚  â”‚  â”‚      â””â”€hmdp
â”‚  â”‚  â”‚          â”‚  HmDianPingApplication.java
â”‚  â”‚  â”‚          â”‚
â”‚  â”‚  â”‚          â”œâ”€config
â”‚  â”‚  â”‚          â”‚      MvcConfig.java
â”‚  â”‚  â”‚          â”‚      MybatisConfig.java
â”‚  â”‚  â”‚          â”‚      RedissonConfig.java
â”‚  â”‚  â”‚          â”‚      WebExceptionAdvice.java
â”‚  â”‚  â”‚          â”‚      WebMvcConfig.java
â”‚  â”‚  â”‚          â”‚
â”‚  â”‚  â”‚          â”œâ”€controller
â”‚  â”‚  â”‚          â”‚      BlogCommentsController.java
â”‚  â”‚  â”‚          â”‚      BlogController.java
â”‚  â”‚  â”‚          â”‚      FollowController.java
â”‚  â”‚  â”‚          â”‚      ShopController.java
â”‚  â”‚  â”‚          â”‚      ShopTypeController.java
â”‚  â”‚  â”‚          â”‚      UploadController.java
â”‚  â”‚  â”‚          â”‚      UserController.java
â”‚  â”‚  â”‚          â”‚      VoucherController.java
â”‚  â”‚  â”‚          â”‚      VoucherOrderController.java
â”‚  â”‚  â”‚          â”‚
â”‚  â”‚  â”‚          â”œâ”€dto
â”‚  â”‚  â”‚          â”‚      LoginFormDTO.java
â”‚  â”‚  â”‚          â”‚      Result.java
â”‚  â”‚  â”‚          â”‚      ScrollResult.java
â”‚  â”‚  â”‚          â”‚      UserDTO.java
â”‚  â”‚  â”‚          â”‚
â”‚  â”‚  â”‚          â”œâ”€entity
â”‚  â”‚  â”‚          â”‚      Blog.java
â”‚  â”‚  â”‚          â”‚      BlogComments.java
â”‚  â”‚  â”‚          â”‚      Follow.java
â”‚  â”‚  â”‚          â”‚      SeckillVoucher.java
â”‚  â”‚  â”‚          â”‚      Shop.java
â”‚  â”‚  â”‚          â”‚      ShopType.java
â”‚  â”‚  â”‚          â”‚      User.java
â”‚  â”‚  â”‚          â”‚      UserInfo.java
â”‚  â”‚  â”‚          â”‚      Voucher.java
â”‚  â”‚  â”‚          â”‚      VoucherOrder.java
â”‚  â”‚  â”‚          â”‚
â”‚  â”‚  â”‚          â”œâ”€mapper
â”‚  â”‚  â”‚          â”‚      BlogCommentsMapper.java
â”‚  â”‚  â”‚          â”‚      BlogMapper.java
â”‚  â”‚  â”‚          â”‚      FollowMapper.java
â”‚  â”‚  â”‚          â”‚      SeckillVoucherMapper.java
â”‚  â”‚  â”‚          â”‚      ShopMapper.java
â”‚  â”‚  â”‚          â”‚      ShopTypeMapper.java
â”‚  â”‚  â”‚          â”‚      UserInfoMapper.java
â”‚  â”‚  â”‚          â”‚      UserMapper.java
â”‚  â”‚  â”‚          â”‚      VoucherMapper.java
â”‚  â”‚  â”‚          â”‚      VoucherOrderMapper.java
â”‚  â”‚  â”‚          â”‚
â”‚  â”‚  â”‚          â”œâ”€service
â”‚  â”‚  â”‚          â”‚  â”‚  IBlogCommentsService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IBlogService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IFollowService.java
â”‚  â”‚  â”‚          â”‚  â”‚  ISeckillVoucherService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IShopService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IShopTypeService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IUserInfoService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IUserService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IVoucherOrderService.java
â”‚  â”‚  â”‚          â”‚  â”‚  IVoucherService.java
â”‚  â”‚  â”‚          â”‚  â”‚
â”‚  â”‚  â”‚          â”‚  â””â”€impl
â”‚  â”‚  â”‚          â”‚          BlogCommentsServiceImpl.java
â”‚  â”‚  â”‚          â”‚          BlogServiceImpl.java
â”‚  â”‚  â”‚          â”‚          FollowServiceImpl.java
â”‚  â”‚  â”‚          â”‚          SeckillVoucherServiceImpl.java
â”‚  â”‚  â”‚          â”‚          ShopServiceImpl.java
â”‚  â”‚  â”‚          â”‚          ShopTypeServiceImpl.java
â”‚  â”‚  â”‚          â”‚          UserInfoServiceImpl.java
â”‚  â”‚  â”‚          â”‚          UserServiceImpl.java
â”‚  â”‚  â”‚          â”‚          VoucherOrderServiceImpl.java
â”‚  â”‚  â”‚          â”‚          VoucherServiceImpl.java
â”‚  â”‚  â”‚          â”‚
â”‚  â”‚  â”‚          â””â”€utils
â”‚  â”‚  â”‚                  CacheClient.java
â”‚  â”‚  â”‚                  ILock.java
â”‚  â”‚  â”‚                  LoginInterceptor.java
â”‚  â”‚  â”‚                  PasswordEncoder.java
â”‚  â”‚  â”‚                  RedisConstants.java
â”‚  â”‚  â”‚                  RedisData.java
â”‚  â”‚  â”‚                  RedisIdWorker.java
â”‚  â”‚  â”‚                  RefreshTokenInterceptor.java
â”‚  â”‚  â”‚                  RegexPatterns.java
â”‚  â”‚  â”‚                  RegexUtils.java
â”‚  â”‚  â”‚                  SimpleRedisLock.java
â”‚  â”‚  â”‚                  SystemConstants.java
â”‚  â”‚  â”‚                  UserHolder.java
â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€resources
â”‚  â”‚      â”‚  application-prod.yaml
â”‚  â”‚      â”‚  application.yaml
â”‚  â”‚      â”‚  seckill.lua
â”‚  â”‚      â”‚  unlock.lua
â”‚  â”‚      â”‚
â”‚  â”‚      â”œâ”€db
â”‚  â”‚      â”‚      hmdp.sql
â”‚  â”‚      â”‚
â”‚  â”‚      â””â”€mapper
â”‚  â”‚              VoucherMapper.xml
â”‚  â”‚
â”‚  â””â”€test
â”‚      â””â”€java
â”‚          â””â”€com
â”‚              â””â”€hmdp
â”‚                      HmDianPingApplicationTests.java
â”‚                      NormalTest.java
â”‚                      RedissonTest.java
â”‚
â””â”€target
```




## é‡åˆ°çš„é—®é¢˜ï¼š
### 1.GEOADDå‘½ä»¤æ— æ³•ä½¿ç”¨
![](https://raw.githubusercontent.com/jackyrwj/picb/master/20230601092430.png)
åŸå› æ˜¯redisç‰ˆæœ¬çš„é—®é¢˜ï¼ŒGEOåŠŸèƒ½æ˜¯åœ¨redis3.2å‡ºæ¥çš„
> ç™»å½•å®¢æˆ·ç«¯åä½¿ç”¨å‘½ä»¤"info server" æ‰“å°redisæœåŠ¡ç«¯ç‰ˆæœ¬
![img.png](img.png)

### 2.gitignoreå¤±æ•ˆ
é¡¹ç›®çš„å‰ç«¯ä¸­å›¾ç‰‡æ–‡ä»¶å¤¹æ— éœ€ä¸Šä¼ ï¼Œé…ç½®gitignoreåå‘ç°å¹¶ä¸ºç”Ÿæ•ˆï¼Œä¸€é¡¿æ‘¸ç´¢æ—¶å€™å‘ç°ï¼š
é¡¹ç›®åˆå§‹åŒ–å .gitignoreéœ€è¦å…ˆcommitä¸€æ¬¡ï¼Œåé¢çš„æ‰èƒ½æ‰«ææ–‡ä»¶å¤¹
 
![](https://raw.githubusercontent.com/jackyrwj/picb/master/20230601093108.png)

### 3. git commitåï¼Œæ’¤é”€commitå¤±è´¥
æ­£å¸¸æ¥è¯´ï¼Œæ™®é€šçš„æ’¤é”€ ä½¿ç”¨å‘½ä»¤ï¼š
```java
git reset --soft HEAD^
```
HEAD^ è¡¨ç¤ºä¸Šä¸€ä¸ªç‰ˆæœ¬ï¼Œå³ä¸Šä¸€æ¬¡çš„commitï¼Œä¹Ÿå¯ä»¥å†™æˆHEAD~1
å¦‚æœè¿›è¡Œä¸¤æ¬¡çš„commitï¼Œæƒ³è¦éƒ½æ’¤å›ï¼Œå¯ä»¥ä½¿ç”¨HEAD~2
ä¸åˆ é™¤å·¥ä½œç©ºé—´çš„æ”¹åŠ¨ä»£ç  ï¼Œæ’¤é”€commitï¼Œä¸æ’¤é”€addï¼Œä½¿ç”¨--soft
åˆ é™¤å·¥ä½œç©ºé—´çš„æ”¹åŠ¨ä»£ç ï¼Œæ’¤é”€commitä¸”æ’¤é”€addï¼Œä½¿ç”¨--hard

å¦å¤–ä¸€ç‚¹ï¼Œå¦‚æœcommitæ³¨é‡Šå†™é”™äº†ï¼Œå…ˆè¦æ”¹ä¸€ä¸‹æ³¨é‡Šï¼Œæœ‰å…¶ä»–æ–¹æ³•ä¹Ÿèƒ½å®ç°ï¼Œå¦‚ï¼š
```agsl
git commit --amend
```
ä½†æ˜¯â—â—â—ï¼Œå¦‚æœç¬¬ä¸€æ¬¡commitï¼Œç”¨ä¸Šè¿°æ–¹æ³•æ˜¯æ— æ³•æ’¤é”€çš„ï¼Œå¯ä»¥ä½¿ç”¨
```java
git update-ref -d HEAD
```
å‘½ä»¤æ¥å®ç°æƒ³è¦çš„æ•ˆæœã€‚å°è¯•è¿‡åï¼Œå‘ç°commitè¢«æˆåŠŸæ’¤é”€ï¼Œä»ç„¶ä¿ç•™äº†addåçš„ç»“æœã€‚

æµ‹è¯•äº†å¥½å¤šæ¬¡commitæ‰è§£å†³ ğŸ˜­

![](https://raw.githubusercontent.com/jackyrwj/picb/master/20230601093915.png)

### 4.Redisçº¿ä¸Šæ•°æ®åŒæ­¥å¤±è´¥
â—â—â— å®å¡”é¢æ¿è‡ªå¸¦çš„redisä¸‹dump.rdbä¸åœ¨é»˜è®¤è·¯å¾„ä¸‹ï¼Œå°†æœ¬åœ°æ•°æ®åŒæ­¥åˆ°çº¿ä¸Šçš„æ—¶å€™è¦æ³¨æ„ï¼ˆæ²‰ç—›æ•™è®­ğŸ˜­ï¼Œredisæ‰˜ç®¡å®¹æ˜“åŸ‹å‘ï¼‰
![](https://raw.githubusercontent.com/jackyrwj/picb/master/20230603101312.png)

å¦å¤–åœ¨ä½¿ç”¨redisæ¶ˆæ¯é˜Ÿåˆ—æ—¶ï¼Œçº¿ä¸Šåˆ«å¿˜è®°ä¹Ÿè¦å…ˆå»ºå¥½æ¶ˆæ¯é˜Ÿåˆ—
```JAVA
XGROUP CREATE stream.orders g1 0 MKSTREAM
```

### 5.æ‹¦æˆªå™¨é”™è¯¯
Springbootæ¡†æ¶ä¸­é€šè¿‡å®ç°WebMvcConfigureræ¥å£ä¸­çš„addInterceptorsæ¥å®ç°æ‹¦æˆªå™¨çš„æ•ˆæœï¼Œ
æœ‰æ­£å‘æ‹¦æˆª(addPathPatterns)å’Œåå‘æ‹¦æˆª(excludePathPatterns),å®é™…ä½¿ç”¨æ¥åå‘æ‹¦æˆªå¾ˆæœ‰å¯èƒ½ç¿»è½¦ï¼Œ
å› ä¸ºé…ç½®çš„æ˜¯"ä¸æ‹¦æˆª"çš„ï¼Œå¾ˆæœ‰å¯èƒ½å¤§éƒ¨åˆ†æ­£å¸¸çš„é¡µé¢ä¼šè¢«æ‹¦æˆªï¼Œ
â—â—â— å¦å¤–,å³ä½¿é…ç½®äº†è¿”å›çš„æ˜¯401"æ— æƒé™",ä½†ä¼šè¢«æµè§ˆå™¨è¯†åˆ«æˆè·¨åŸŸï¼ˆè¿˜ä¸çŸ¥é“å¯¼è‡´çš„ï¼‰
æœ€åè¿˜æ˜¯é€šè¿‡æ­£å‘æ‹¦æˆªè§£å†³äº†orzã€‚
```java
public class MvcConfig implements WebMvcConfigurer {

    @Resource
    private StringRedisTemplate stringRedisTemplate;

    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        // ç™»å½•æ‹¦æˆªå™¨
//        registry.addInterceptor(new LoginInterceptor())
//                .excludePathPatterns(
//                        "/shop/**",
//                        "/voucher/**",
//                        "/shop-type/**",
//                        "/upload/**",
//                        "/blog/hot",
//                        "/user/code",
//                        "/user/login"
//                ).order(1);
        registry.addInterceptor(new LoginInterceptor())
                .addPathPatterns(
                        "/follow/**/**", 
                        "/voucher-order/**"
                ).order(1);
        // tokenåˆ·æ–°çš„æ‹¦æˆªå™¨
        registry.addInterceptor(new RefreshTokenInterceptor(stringRedisTemplate)).addPathPatterns("/**").order(0);
    }
}
```